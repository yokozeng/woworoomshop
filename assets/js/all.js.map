{"version":3,"sources":["all.js"],"names":["console","clear","apiPath","token","orderData","orderList","document","querySelector","thead","tbodyList","primary","primaryLight","light","colors","getOrderList","axios","get","headers","Authorization","then","response","data","orders","log","length","innerHTML","productCategory","theadStr","date","orderStatusText","str","forEach","item","index","paid","Date","createdAt","getFullYear","getMonth","getDate","productsStr","products","title","quantity","id","user","name","tel","address","email","addEventListener","e","orderId","target","getAttribute","orderClassName","orderStatus","editOrderListStatus","deleteOrderItem","deleteAllOrder","newStatus","put","alert","error","chart","obj","objAry","productCategoryAry","items","category","undefined","Object","keys","ary","push","sort","a","b","renderC3","arrayName","pieChart","c3","generate","bindto","columns","type"],"mappings":"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","file":"all.js","sourcesContent":["//首頁跟後台拆開做\n\n/*\n\n戳所有產品API getProductsList() -> 取得產品資料\n跑forEach 組字串-> 顯示產品資訊\nselect綁change監聽 -> 篩選產品資訊\n*/\n\nconsole.clear();\n\nlet apiPath = \"zengzeng\";\nlet token = \"JZrWxOJ9QrMv7bwenU4Xp94h4M12\";\nlet orderData = [];\n\n//DOM元素\nconst orderList = document.querySelector(\".orderList\");\nconst thead = document.querySelector(\".thead\");\nconst tbodyList = document.querySelector(\".tbodyList\");\n\n// 圖表顏色變數\n//const primaryDark = \"#301E5F\";\nconst primary = \"#937218\";\nconst primaryLight = \"#c79a20\";\nconst light = \"#c7b06f\";\n// 類別排名高到低\nlet colors = [primary, primaryLight, light];\n\n/*========================= 後台 =========================*/\n\n/*---------- 訂單相關(管理者) ----------*/\n\n// GET 取得訂單列表 (v)\nfunction getOrderList() {\n  axios\n    .get(\n      `https://livejs-api.hexschool.io/api/livejs/v1/admin/${apiPath}/orders`,\n      {\n        headers: {\n          Authorization: token\n        }\n      }\n    )\n    .then(function (response) {\n      //console.log('成功',response.data.orders);\n      orderData = response.data.orders;\n      //console.log(\"response.data.orders1\", orderData);\n      console.log(\"length\", orderData.length);\n      console.log(orderData.length == 0)\n      //判斷訂單內有無東西\n      if (orderData.length == 0) {\n        orderList.innerHTML = `\n            <p class=\"text-center text-secondary\">\n              目前沒有訂單唷(っ˘ω˘ς )\n            </p>\n          `;\n        return;\n      } else {\n        console.log(\"render中\");\n        \n        //render 圖表\n        productCategory(orderData);\n        \n        //table head字串\n        let theadStr = `\n        <div>\n        <input type=\"button\" value=\"清除全部訂單\" class=\"deleteAllOrderBtn\">\n        <tr>\n      <th>訂單編號</th>\n      <th>聯絡人</th>\n      <th>聯絡地址</th>\n      <th>電子郵件</th>\n      <th>訂單品項</th>\n      <th>訂單日期</th>\n      <th>訂單狀態</th>\n      <th>操作</th>\n    </tr>`;\n        thead.innerHTML = theadStr;\n        \n        let date;\n        let orderStatusText = '';\n        let str = \"\";\n       \n        \n        //forEach\n        orderData.forEach(function (item,index) {\n          \n          // 訂單狀態轉換\n          if(item.paid === false){\n            orderStatusText = '未處理';\n          }else{\n            orderStatusText = '已處理'\n          }\n          \n          // 日期轉換\n          date = new Date(item.createdAt*1000); \n    date = `${date.getFullYear()}/${date.getMonth()+1}/${date.getDate()}`;\n          \n          // 印出產品項目1\n          let productsStr = '';\n          item.products.forEach(function(item){\n            productsStr += `<p>${item.title} x ${item.quantity}</p>`\n          })\n          \n          \n          //組 table body字串\n          str += `<tr>\n                    <td>${item.id}</td>\n                    <td>\n                      <p>${item.user.name}</p>\n                      <p>${item.user.tel}</p>\n                    </td>\n                    <td>${item.user.address}</td>\n                    <td>${item.user.email}</td>\n                    <td>\n                      <p>${productsStr}</p>\n                    </td>\n                    <td>${date}</td>\n                    <td class=\"orderStatus\">\n                      <input type=\"button\" class=\"orderStatusBtn\" data-id=\"${item.id}\" data-status=\"${item.paid}\" value=\"${orderStatusText}\">\n                    </td>\n                    <td>\n                      <input type=\"button\" class=\"delSingleOrderBtn\" data-id=\"${item.id}\" value=\"刪除\">\n                    </td>\n                </tr>`;\n        });\n        console.log(\"response.data.orders2\", orderData);\n        tbodyList.innerHTML = str;\n      }\n    });\n};\ngetOrderList();\n\n//監聽\norderList.addEventListener(\"click\", function (e) {\n  //console.log('id啦',e.target.dataset.id)\n  let orderId = e.target.getAttribute('data-id');\n  let orderClassName = e.target.getAttribute(\"class\");\n  let orderStatus = e.target.getAttribute('data-status');\n  console.log('paidStatus', orderStatus);\n  console.log('id',orderId);\n  console.log('class',orderClassName);\n \n  //觸發 修改訂單狀態\n  if (orderClassName == \"orderStatusBtn\") {\n    editOrderListStatus(orderStatus, orderId);\n  }\n\n  //觸發 刪除特定訂單\n if (orderClassName == \"delSingleOrderBtn\") {\n   deleteOrderItem(orderId);\n }\n  \n  //觸發 清空全部訂單\n if (orderClassName == \"deleteAllOrderBtn\") {\n    deleteAllOrder();\n }\n\n});\n\n// PUT 修改訂單狀態 (v)\nfunction editOrderListStatus(orderStatus, orderId) {\n  console.log(\"修改中\");\n  // 轉換訂單狀態\n  let newStatus;\n  if (orderStatus == \"true\") {\n    newStatus = false;\n  } else {\n    newStatus = true;\n  };\n  console.log(\"newStatus\", newStatus);\n\n  axios\n    .put(\n      `https://livejs-api.hexschool.io/api/livejs/v1/admin/${apiPath}/orders`,\n      {\n        data: {\n          id: orderId,\n          paid: newStatus\n        }\n      },\n      {\n        headers: {\n          Authorization: token\n        }\n      }\n    )\n    .then(function (response) {\n      alert(\"狀態修改成功 (*´▽`*)\");\n      console.log(\"狀態修改成功 (*´▽`*)\");\n      getOrderList();\n    })\n    .catch(function (error) {\n      console.log(\"狀態修改失敗\", error.response.data);\n    });\n};\n\n// DELETE 清空全部訂單\nfunction deleteAllOrder() {\n  axios\n    .delete(\n      `https://livejs-api.hexschool.io/api/livejs/v1/admin/${apiPath}/orders`,\n      {\n        headers: {\n          Authorization: token\n        }\n      }\n    )\n    .then(function (response) {\n      console.log(response.data);\n      alert(\"訂單已全部清空。 (*´▽`*)\");\n      getOrderList();\n    });\n};\n\n// DELETE 刪除特定訂單 (v)\nfunction deleteOrderItem(orderId){\n  console.log('準備刪除訂單囉～');\n   axios.delete(`https://livejs-api.hexschool.io/api/livejs/v1/admin/${apiPath}/orders/${orderId}`,\n    {\n      headers: {\n        'Authorization': token\n      }\n    })\n    .then(function (response) {\n      console.log(response.data);\n      alert('訂單刪除成功 (*´▽`*)');\n      getOrderList();\n    });\n  \n  \n};\n\n// 圖表 全品項營收比重\nfunction productCategory(orderData) {\n    if (orderData.length == 0) {\n        chart.innerHTML = `<p>目前沒有訂單唷(っ˘ω˘ς )</p>`;\n    } else {\n      \n        let obj = {};\n        let objAry = [];\n        let productCategoryAry = [];\n      // 篩選類別，並累加數量上去\n        orderData.forEach(function (items) {\n            items.products.forEach(function (item) {\n              console.log('obj',obj)\n                console.log('類別數量',obj[item.category]);\n                if (obj[item.category] === undefined) {\n                    obj[item.category] = item.quantity;\n                } else {\n                    obj[item.category] += item.quantity;\n                }\n                console.log('最後類別數量',obj[item.category]);\n            })\n        });\n      // 將資料處理成符合 c3 要的格式，存進 productCategoryAry\n        objAry = Object.keys(obj);\n        console.log('objAry',objAry);\n        objAry.forEach(function (item) {\n            let ary = [];\n            ary.push(item);\n            ary.push(obj[item]);\n            productCategoryAry.push(ary);\n        })\n      console.log('productCategoryAry',productCategoryAry)\n\n        // 排序 (多到少)\n        productCategoryAry.sort(function (a, b) {\n            return b[1] - a[1];\n          \n        });\n\n        renderC3(productCategoryAry);\n    }\n}\n\n// 圖表 renderC3\nfunction renderC3(ary) {\n\n    // 處理顏色格式\n    let arrayName = {};\n    ary.forEach(function (item, index) {\n        if (arrayName[item[0]] === undefined) {\n            arrayName[item[0]] = colors[index];\n        }\n    })\n\n  //c3產生器\n    const pieChart = c3.generate({\n        bindto: \"#chart\", \n        data: {\n            columns: ary, // 資料存放\n            type: \"pie\", // 圖表種類\n            colors: arrayName\n        }\n    });\n}"]}